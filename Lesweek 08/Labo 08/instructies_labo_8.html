<!DOCTYPE html>
<html>
<head>
<title>instructies_labo_08.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<!-- 
DISCLAIMER:

!!!!

GEBRUIK NIET DIT BESTAND OM HET LABO TE MAKEN MAAR GEBRUIK DE LINK OP DIGITAP!

!!!!
-->
<style>
.holder_default {
    width:500px; 
    height:150px; 
    border: 3px dashed #ccc;
}

.hover { 
    width:400px; 
    height:150px; 
    border: 3px dashed #0c0 !important; 
}

.hidden {
    visibility: hidden;
}

.visible {
    visibility: visible;
}
</style>
<script type="application/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
<form action="/task" method="post">
<h1 id="introductie">Labo 08: Cookies</h1>
<p>Zoals altijd kunnen de oefeningen binnengehaald worden door een git pull te doen.</p>
<pre class="hljs"><code><div>git pull
</div></code></pre>
<p>of de git repository te clonen als je deze nog niet hebt.</p>
<pre class="hljs"><code><div>git clone https://github.com/janvandenpoelatAP/AP_PRO2TS2425_SEC.git
</div></code></pre>
<h3 id="wat-ga-je-leren-in-dit-labo">Wat ga je leren in dit labo?</h3>
<ul>
<li>Gebruik maken van Chrome Developer Tools</li>
<li>Gebruik maken van tools zoals postman, curl,...</li>
<li>De werking van JWT tokens begrijpen en gebruiken.</li>
<li>Concepten als secret key en expiration van een token begrijpen.</li>
</ul>
<h3 id="stappenplan">Stappenplan</h3>
<ol>
<li>
<p>Ga naar jouw eigen juice shop die je hebt opgezet in het eerste labo. De url zou er als volgt moeten uitzien als je de instructies juist hebt gevolgd:</p>
<p><code>https://gitpod.io/</code></p>
<p><strong>Opgelet</strong>: Dit kan een tijdje duren. Hou hier rekening mee.</p>
</li>
<li>
<p>Open de Chrome Developer Tools en zorg ervoor dat de Network tab open staat.</p>
</li>
<li>
<p>Log in als de administrator van de juice shop.</p>
<p><em>Tip:</em> Deze login gegevens heb je in vorige labo's gevonden.</p>
</li>
<li>
<p>Zoek nu de login request terug in de lijst van network calls in de Network tab.</p>
<p>Open deze en ga op zoek naar de JWT token die wordt aangemaakt bij het inloggen.</p>
<p>Neem een screenshot waar deze token duidelijk opstaat en sleep deze hieronder in</p>
 <div id="jwttoken" style="" class="holder_default">
       <img src="" id="jwttoken_image_droped"  style="max-width:80%; border: 3px dashed #7A97FC;" class=" hidden"/>
 </div>
 <script>
     $(document).ready(function() {
         addDrop('jwttoken')
     });
 </script>
<p>Vul ook hieronder de volledige JWT token in:</p>
 <textarea style="width: 100%;" rows="4">
 </textarea>
</li>
<li>
<p>Ga nu naar de Application tab en zoek in de <code>Local Storage</code> waar deze token wordt opgeslagen. Neem hiervan een screenshot en duid duidelijk aan waar het staat. Sleep deze hieronder in:</p>
 <div id="jwttoken2" style="" class="holder_default">
       <img src="" id="jwttoken2_image_droped"  style="max-width:80%; border: 3px dashed #7A97FC;" class=" hidden"/>
 </div>
 <script>
     $(document).ready(function() {
         addDrop('jwttoken2')
     });
 </script>
</li>
<li>
<p>We gaan nu een aantal andere manieren bekijken om een request na te bootsen. We gaan eerst deze request leren uitvoeren via het curl commando.</p>
<p>curl is een command line tool die toelaat http requests uit te voeren vanuit git bash.</p>
</li>
<li>
<p>Voer het commando</p>
<p><code>curl -i https://www.google.com/blabla</code></p>
<p>uit om te testen dat het bij jou werkt.</p>
<p>De <code>-i</code> optie zorgt ervoor dat je ook de response headers en de http status code te zien krijgt.</p>
<p>Welke status code geeft deze website terug en waarom?</p>
 <textarea style="width: 100%;" rows="4">
 </textarea>
</li>
<li>
<p>De chrome developer tools laten het ook toe om http requests te kopieren als curl commando zodat je dit niet elke keer zelf moet ingeven.</p>
<p>Kopieer de login request door er met je rechter muisknop op te klikken en dan vervolgens te kopieren als curl commando.</p>
 <img src="copyascurl.png" width="320">
</li>
<li>
<p>Plak dit commando in je <code>git bash</code> terminal in visual studio code. Pas dit commando wel nog aan zodat je ook nog de http response headers te zien krijgt.</p>
<p>Neem een screenshot van het resultaat en zorg er voor dat de headers en de response body goed te zien is. Sleep deze hieronder in:</p>
 <div id="curlcommand" style="" class="holder_default">
       <img src="" id="curlcommand_image_droped"  style="max-width:80%; border: 3px dashed #7A97FC;" class=" hidden"/>
 </div>
 <script>
     $(document).ready(function() {
         addDrop('curlcommand')
     });
 </script>
</li>
<li>
<p>Ga naar de administration page van de juice shop en probeer (op het pad <code>/#/administration</code>). En probeer via de chrome developer tools de <code>authentication-details</code> url te vinden.</p>
<p>Je kan deze kopieren door er met je rechter muisknop op te klikken, <code>copy</code> en dan <code>copy link address</code> te doen. Geef de url hier onder in:</p>
<textarea style="width: 100%;" rows="2">
</textarea>
</li>
<li>
<p>Installeer Postman door naar het adres https://www.postman.com te gaan en de installatie procedure te doorlopen.</p>
</li>
<li>
<p>Maak in postman een GET request naar de url die je in de vorige stap gevonden hebt (die van <code>authentication-details</code>)</p>
<p>Waarom werkt dit niet?</p>
<textarea style="width: 100%;" rows="4">
</textarea>
</li>
<li>
<p>Doe dezelfde GET request in postman maar geef deze keer de Authorization Header mee. Je doet dit op de volgende manier:</p>
<img src="addbearertoken.png" width="640">
<p>Neem een screenshot van het resultaat en plak dit hieronder in:</p>
<div id="addbearer" style="" class="holder_default">
      <img src="" id="addbearer_image_droped"  style="max-width:80%; border: 3px dashed #7A97FC;" class=" hidden"/>
</div>
<script>
    $(document).ready(function() {
        addDrop('addbearer')
    });
</script>
</li>
<li>
<p>Je kan ook een volledige curl commando importeren in Postman. Kopieer het curl commando van de <code>authentication-details</code> en vervolgens doe je in postman:
Import -&gt; Raw Text en plak je de volledige curl commando van deze request hier in en druk je vervolgens op import.</p>
</li>
<li>
<p>Nu gaan we eens het token decoden zodat we kunnen kijken wat de inhoud ervan is. Ga naar <a target="_blank" href="https://jwt.io/">jwt.io</a> en ga naar debugger. Daar kan je het JWT token in plakken dat je hiervoor gevonden hebt.</p>
<p>Maak een screenshot van deze website zodat het encoded gedeelte en decoded gedeelte duidelijk zichtbaar zijn. Sleep deze screenshot hieronder in:</p>
<div id="jwtio" style="" class="holder_default">
      <img src="" id="jwtio_image_droped"  style="max-width:80%; border: 3px dashed #7A97FC;" class=" hidden"/>
</div>
<script>
    $(document).ready(function() {
        addDrop('jwtio')
    });
</script>
</li>
<li>
<p>Er zijn hier twee interessante velden. De expiration time (exp) en issued at time (iat). Op welke datum (en om hoe laat) vervalt deze token.</p>
<textarea style="width: 100%;" rows="2">
</textarea>
<p>Tip: De tijd is uitgedrukt in iets dat de unix timestamp heet. Dit zijn het aantal milliseconden sinds 1 januari 1970. Zoek zelf op het internet hoe je dit moet omzetten naar een leesbare datum.</p>
</li>
<li>
<p>Wat staat er in de payload van de jwt token dat er absoluut niet mag instaan?</p>
<textarea style="width: 100%;" rows="4">
</textarea>
</li>
<li>
<p>Gebruik het onderstaande token om de <code>authentication-details</code> endpoint aan te spreken (in postman).</p>
<pre class="hljs"><code><div>eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJzdGF0dXMiOiJzdWNjZXNzIiwiZGF0YSI6eyJpZCI6MSwidXNlcm5hbWUiOiIiLCJlbWFpbCI6ImFkbWluQGp1aWNlLXNoLm9wIiwicGFzc3dvcmQiOiIwMTkyMDIzYTdiYmQ3MzI1MDUxNmYwNjlkZjE4YjUwMCIsInJvbGUiOiJhZG1pbiIsImRlbHV4ZVRva2VuIjoiIiwibGFzdExvZ2luSXAiOiIwLjAuMC4wIiwicHJvZmlsZUltYWdlIjoiYXNzZXRzL3B1YmxpYy9pbWFnZXMvdXBsb2Fkcy9kZWZhdWx0QWRtaW4ucG5nIiwidG90cFNlY3JldCI6IiIsImlzQWN0aXZlIjp0cnVlLCJjcmVhdGVkQXQiOiIyMDIxLTAzLTMxIDEzOjMyOjU1LjQ1MiArMDA6MDAiLCJ1cGRhdGVkQXQiOiIyMDIxLTAzLTMxIDEzOjMyOjU1LjQ1MiArMDA6MDAiLCJkZWxldGVkQXQiOm51bGx9LCJpYXQiOjE2MTcxOTc2NTksImV4cCI6MTYxNzIxNTY1OX0.Byi9R76JFCkYm4qIIMNrbfpymqGssIp7jSuQACkzme9QrgoqqjgndsFdEkjei74tPRr9gtepettgd5-LCW6GEqrtAn47pNFrn98aBaDHz7lnJ6E5F8Vm7ZoiTHDOODHszqy4oDRORpME9CYyJMcII6mSauA6MJtJ5WIa6UmQolk
</div></code></pre>
<p>Wat geeft deze terug als response:</p>
<textarea style="width: 100%;" rows="10">
</textarea>
<p>Waarom is dit?</p>
<textarea style="width: 100%;" rows="3">
</textarea>
</li>
<li>
<p>We gaan nu eens een token proberen aan te passen. Kopieer het tweede deel (de payload) van de JWT token (na het eerste puntje) en decodeer dit deel met een base64 decoder (base64decode.org of burpsuite)</p>
<img src="payload.png" width="320">
</li>
<li>
<p>Vervolgens pas je hier het email adres en de id aan naar iets anders en encodeer je vervolgens dit terug naar base64 (base64encode.org of burpsuite).</p>
</li>
<li>
<p>Kopieer nu dit stukje terug op dezelfde plaats in de JWT token waar het vandaan komt en gebruik nu deze token om de <code>authentication-details</code> endpoint aan te spreken (in postman)</p>
<p>Wat geeft deze terug als response:</p>
<textarea style="width: 100%;" rows="10">
</textarea>
<p>Waarom is dit?</p>
<textarea style="width: 100%;" rows="3">
</textarea>
</li>
<li>
<p>Print deze pagina af als PDF en slaag deze op als <code>naam_voornaam_labo_tokens.pdf</code> en stuur deze door via digitap.</p>
</li>
</ol>
<script>
function addDrop(id) {
    var holder = document.getElementById(id);
    holder.ondragover = function () { this.className = 'hover'; return false; };
    holder.ondrop = function (e) {
      this.className = 'hidden';
      e.preventDefault();
      var file = e.dataTransfer.files[0];
      var reader = new FileReader();
      reader.onload = function (event) {
          document.getElementById(id + '_image_droped').className='visible'
          $('#' + id + '_image_droped').attr('src', event.target.result);
      }
      reader.readAsDataURL(file);
    };
}
</script>

</body>
</html>
